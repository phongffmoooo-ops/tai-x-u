<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ğŸ² TÃ i Xá»‰u + AI + Phiáº¿u + Admin ğŸ²</title>
<style>
body { text-align: center; font-family: Arial, sans-serif; background: linear-gradient(to bottom, #f0f8ff, #a0d8f1); margin: 0; padding: 20px;}
h1 { font-size: 2em; margin-bottom: 20px; }
#cup { width: 120px; height: 120px; background: brown; border-radius: 50%; margin: 20px auto; cursor: pointer; position: relative; transition: transform 0.5s, top 0.5s; }
#cup.flip { transform: rotateX(180deg); top: 50px; }
#dice, #aiDice { font-size: 50px; display: flex; justify-content: center; gap: 10px; margin: 20px; min-height: 60px; }
#aiDice { color: red; }
button { padding: 8px 16px; font-size: 14px; cursor: pointer; margin: 4px; border-radius: 5px; border: none; background: #4caf50; color: white; transition: background 0.3s; }
button:hover { background: #45a049; }
#timer { font-size: 18px; margin-top: 10px; }
#result { font-size: 20px; font-weight: bold; margin-top: 10px; color: #333; }
input, select { padding: 6px; font-size: 14px; border-radius: 5px; border: 1px solid #ccc; margin-top: 5px; }
.select-reward, #adminSection { margin-top: 10px; }
#inventory, #vouchers { margin-top: 20px; font-size: 16px; color: #222; text-align: left; display:inline-block; }
.voucher-btn { background: #ff9800; margin: 2px; }
.admin-section { background:#f9f9f9; border:1px solid #ccc; padding:10px; border-radius:8px; margin-top:20px; display:inline-block; }
.code-list { margin-top:10px; max-height:150px; overflow-y:auto; border:1px solid #ccc; padding:5px; }
@keyframes jump { 0%{transform:translateY(0);}25%{transform:translateY(-20px);}50%{transform:translateY(0);}75%{transform:translateY(-10px);}100%{transform:translateY(0);} }
.dice-jump { animation: jump 0.5s; }
</style>
</head>
<body>

<h1>ğŸ² TÃ i Xá»‰u + AI + Phiáº¿u + Admin ğŸ²</h1>
<p>Báº¥m vÃ o chÃ©n Ä‘á»ƒ láº¯c 3 viÃªn xÃºc xáº¯c! AI sáº½ cáº¡nh tranh vá»›i báº¡n.</p>

<div id="cup"></div>
<div id="dice"></div>
<div id="aiDice"></div>

<button id="startBtn">Báº¯t Ä‘áº§u xÃºc xÃ­ ngáº§u (1 phÃºt)</button>
<p id="timer"></p>
<p id="result"></p>

<!-- Nháº­p code -->
<div>
    <input type="text" id="giftCode" placeholder="Nháº­p code nháº­n quÃ ">
    <button id="checkCodeBtn">Nháº­n quÃ </button>
</div>
<div class="select-reward" id="rewardSelect" style="display:none;">
    <p>Chá»n quÃ  báº¡n thÃ­ch:</p>
    <button class="rewardBtn" data-type="money">ğŸ’° Tiá»n</button>
    <button class="rewardBtn" data-type="points">â­ Äiá»ƒm thÆ°á»Ÿng</button>
    <button class="rewardBtn" data-type="item">ğŸ Váº­t pháº©m áº£o</button>
</div>
<p id="giftResult" style="font-weight:bold; margin-top:10px;"></p>

<!-- Inventory -->
<div id="inventory">
    <p>ğŸ’° Tiá»n: <span id="money">0</span></p>
    <p>â­ Äiá»ƒm thÆ°á»Ÿng: <span id="points">0</span></p>
    <p>ğŸ Váº­t pháº©m áº£o: <span id="items">0</span></p>
</div>

<!-- Phiáº¿u quÃ  -->
<div id="vouchers">
    <p>ğŸ“œ Phiáº¿u quÃ :</p>
    <div id="voucherList"></div>
</div>

<!-- Admin Panel -->
<div id="adminSection" class="admin-section">
    <button id="openAdminBtn">ğŸ”‘ Má»Ÿ Admin Panel</button>
    <div id="adminPanelContent" style="display:none;">
        <h3>âš™ï¸ Admin Panel</h3>
        <p>ThÃªm code má»›i:</p>
        <input type="text" id="newCode" placeholder="Code má»›i">
        <select id="newCodeType">
            <option value="money">ğŸ’° Tiá»n</option>
            <option value="points">â­ Äiá»ƒm</option>
            <option value="item">ğŸ Váº­t pháº©m</option>
            <option value="voucherMoney">ğŸ“œ Phiáº¿u Tiá»n</option>
            <option value="voucherPoints">ğŸ“œ Phiáº¿u Äiá»ƒm</option>
            <option value="voucherItem">ğŸ“œ Phiáº¿u Váº­t pháº©m</option>
        </select>
        <input type="number" id="newCodeValue" placeholder="GiÃ¡ trá»‹" min="1">
        <button id="addCodeBtn">ThÃªm Code</button>

        <h4>Danh sÃ¡ch code:</h4>
        <div id="codeList" class="code-list"></div>
    </div>
</div>

<script>
/* ================== Há»† THá»NG ================== */
let timerId; let timeLeft=60;
const cup=document.getElementById('cup'); const diceDiv=document.getElementById('dice'); const aiDiceDiv=document.getElementById('aiDice');
const timerText=document.getElementById('timer'); const resultText=document.getElementById('result');
const inventoryMoney=document.getElementById('money'); const inventoryPoints=document.getElementById('points'); const inventoryItems=document.getElementById('items');
const voucherList=document.getElementById('voucherList');
const giftCodeInput=document.getElementById('giftCode'); const checkCodeBtn=document.getElementById('checkCodeBtn');
const rewardSelect=document.getElementById('rewardSelect'); const giftResult=document.getElementById('giftResult');

const diceFaces=['\u2680','\u2681','\u2682','\u2683','\u2684','\u2685'];

// LÆ°u trá»¯
let inventory=JSON.parse(localStorage.getItem("inventory")||'{"money":0,"points":0,"items":0}');
let vouchers=JSON.parse(localStorage.getItem("vouchers")||'[]');
let codes=JSON.parse(localStorage.getItem("codes")||'[]'); // {code,type,value,used}

// Cáº­p nháº­t hiá»ƒn thá»‹
function saveAll(){localStorage.setItem("inventory",JSON.stringify(inventory)); localStorage.setItem("vouchers",JSON.stringify(vouchers)); localStorage.setItem("codes",JSON.stringify(codes));}
function updateInventory(){inventoryMoney.textContent=inventory.money;inventoryPoints.textContent=inventory.points;inventoryItems.textContent=inventory.items;}
function updateVouchers(){voucherList.innerHTML=''; vouchers.forEach((v,i)=>{ let btn=document.createElement('button'); btn.textContent=`${v.type} +${v.value}`; btn.className='voucher-btn'; btn.onclick=()=>{useVoucher(i);}; voucherList.appendChild(btn);});}
function updateCodeList(){ const list=document.getElementById('codeList'); list.innerHTML=''; codes.forEach(c=>{ const div=document.createElement('div'); div.textContent=`${c.code} | ${c.type} +${c.value} | ${c.used?'ÄÃ£ dÃ¹ng':'ChÆ°a dÃ¹ng'}`; list.appendChild(div); }); }
updateInventory(); updateVouchers(); updateCodeList();

/* ================== Phiáº¿u ================== */
function useVoucher(index){
    const v=vouchers[index];
    if(v.type==='Tiá»n') inventory.money+=v.value;
    if(v.type==='Äiá»ƒm') inventory.points+=v.value;
    if(v.type==='Váº­t pháº©m') inventory.items+=v.value;
    vouchers.splice(index,1); saveAll(); updateInventory(); updateVouchers();
    alert(`Báº¡n Ä‘Ã£ sá»­ dá»¥ng phiáº¿u ${v.type} +${v.value}`);
}

/* ================== Game & AI ================== */
function rollOneDice(){ return diceFaces[Math.floor(Math.random()*6)]; }
function rollThreeDice(){ const dice=[rollOneDice(),rollOneDice(),rollOneDice()]; const points=dice.map(d=>diceFaces.indexOf(d)+1); return {dice,points,sum:points.reduce((a,b)=>a+b,0)}; }
function aiRoll(playerSum){ const rnd=Math.random(); let aiSum; if(rnd<0.3) aiSum=playerSum+Math.floor(Math.random()*3+1); else if(rnd<0.6) aiSum=playerSum-Math.floor(Math.random()*3+1); else aiSum=playerSum; if(aiSum<3) aiSum=3; if(aiSum>18) aiSum=18; const dices=[]; let remaining=aiSum; for(let i=0;i<3;i++){ let val=Math.min(Math.max(1,Math.floor(Math.random()*6)),remaining-(2-i)); dices.push(val); remaining-=val;} return {dice:dices.map(v=>diceFaces[v-1]),sum:aiSum};}

startBtn.onclick=()=>{timeLeft=60; resultText.textContent=''; diceDiv.textContent=''; aiDiceDiv.textContent=''; timerText.textContent=`Thá»i gian cÃ²n láº¡i: ${timeLeft}s`; clearInterval(timerId); timerId=setInterval(()=>{timeLeft--; timerText.textContent=`Thá»i gian cÃ²n láº¡i: ${timeLeft}s`; if(timeLeft<=0){clearInterval(timerId); alert('Háº¿t giá» xÃºc xÃ­ ngáº§u!');}},1000);}

cup.onclick=()=>{
    if(timeLeft<=0){alert('ÄÃ£ háº¿t giá»! Báº¥m "Báº¯t Ä‘áº§u" Ä‘á»ƒ chÆ¡i láº¡i.'); return;}
    cup.classList.add('flip'); diceDiv.innerHTML=''; aiDiceDiv.innerHTML='';
    for(let i=0;i<3;i++){ let span=document.createElement('span'); span.textContent=rollOneDice(); span.classList.add('dice-jump'); diceDiv.appendChild(span);}
    for(let i=0;i<3;i++){ let span=document.createElement('span'); span.textContent=rollOneDice(); span.classList.add('dice-jump'); aiDiceDiv.appendChild(span);}
    setTimeout(()=>{
        cup.classList.remove('flip');
        const player=rollThreeDice();
        const ai=aiRoll(player.sum);
        diceDiv.innerHTML=''; aiDiceDiv.innerHTML='';
        player.dice.forEach(d=>{ let span=document.createElement('span'); span.textContent=d; diceDiv.appendChild(span);});
        ai.dice.forEach(d=>{ let span=document.createElement('span'); span.textContent=d; aiDiceDiv.appendChild(span);});
        const playerResult=(player.sum>=11&&player.sum<=17)?'TÃ i':'Xá»‰u';
        const aiResult=(ai.sum>=11&&ai.sum<=17)?'TÃ i':'Xá»‰u';
        let winner="";
        if(player.sum>ai.sum) winner="Báº¡n tháº¯ng! ğŸ†";
        else if(player.sum<ai.sum) winner="AI tháº¯ng! ğŸ¤–";
        else winner="HÃ²a! âš–ï¸";
        resultText.textContent=`Báº¡n: ${player.sum}â†’${playerResult} | AI: ${ai.sum}â†’${aiResult} â†’ ${winner}`;
    },1000);
}

/* ================== Code quÃ  ================== */
checkCodeBtn.onclick=()=>{
    const code=giftCodeInput.value.trim().toUpperCase();
    const c=codes.find(c=>c.code===code);
    if(!c){ rewardSelect.style.display='none'; giftResult.textContent="Code khÃ´ng há»£p lá»‡!"; return;}
    if(c.used){ rewardSelect.style.display='none'; giftResult.textContent="Code Ä‘Ã£ dÃ¹ng!"; return;}
    rewardSelect.style.display='block'; giftResult.textContent="Code há»£p lá»‡! Chá»n quÃ :"; giftCodeInput.dataset.currentCode=code;
}

document.querySelectorAll('.rewardBtn').forEach(btn=>{
    btn.onclick=()=>{
        const code=giftCodeInput.dataset.currentCode;
        if(!code) return;
        const c=codes.find(c=>c.code===code);
        if(!c) return;
        c.used=true;
        if(c.type==='money'){ inventory.money+=c.value;}
        if(c.type==='points'){ inventory.points+=c.value;}
        if(c.type==='item'){ inventory.items+=c.value;}
        if(c.type==='voucherMoney'){ vouchers.push({type:'Tiá»n',value:c.value});}
        if(c.type==='voucherPoints'){ vouchers.push({type:'Äiá»ƒm',value:c.value});}
        if(c.type==='voucherItem'){ vouchers.push({type:'Váº­t pháº©m',value:c.value});}
        saveAll(); updateInventory(); updateVouchers(); updateCodeList();
        giftResult.textContent=`Báº¡n nháº­n Ä‘Æ°á»£c ${c.type} +${c.value}!`; rewardSelect.style.display='none'; giftCodeInput.value=''; giftCodeInput.dataset.currentCode='';
    }
});

/* ================== Admin vá»›i máº­t kháº©u ================== */
const openAdminBtn=document.getElementById('openAdminBtn');
const adminPanelContent=document.getElementById('adminPanelContent');
openAdminBtn.onclick=()=>{
    const pwd=prompt("Nháº­p máº­t kháº©u admin:");
    if(pwd==="1234567890"){ adminPanelContent.style.display="block"; alert("ChÃ o má»«ng admin!"); }
    else alert("Sai máº­t kháº©u!");
}

document.getElementById('addCodeBtn').onclick=()=>{
    const code=document.getElementById('newCode').value.trim().toUpperCase();
    const type=document.getElementById('newCodeType').value;
    const value=parseInt(document.getElementById('newCodeValue').value);
    if(!code || !type || isNaN(value)){ alert('Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§!'); return;}
    codes.push({code,type,value,used:false}); saveAll(); updateCodeList();
    alert(`ThÃªm code ${code} thÃ nh cÃ´ng!`); document.getElementById('newCode').value=''; document.getElementById('newCodeValue').value='';
}
</script>
</body>
</html>

